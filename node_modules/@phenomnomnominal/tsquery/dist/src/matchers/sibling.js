"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Dependencies:
var match_1 = require("../match");
var traverse_1 = require("../traverse");
// Constants:
var LEFT = 'left';
var RIGHT = 'right';
function sibling(node, selector, ancestry) {
    return match_1.findMatches(node, selector.right, ancestry) &&
        findSibling(node, selector.left, ancestry, LEFT) ||
        selector.left.subject &&
            match_1.findMatches(node, selector.left, ancestry) &&
            findSibling(node, selector.right, ancestry, RIGHT);
}
exports.sibling = sibling;
function findSibling(node, selector, ancestry, side) {
    var parent = ancestry[0];
    if (!parent) {
        return false;
    }
    var keys = traverse_1.getVisitorKeys(node.parent || null);
    return keys.some(function (key) {
        var prop = node.parent[key];
        if (Array.isArray(prop)) {
            var index = prop.indexOf(node);
            if (index === -1) {
                return false;
            }
            if (side === LEFT) {
                return prop.slice(0, index).some(function (precedingSibling) {
                    return match_1.findMatches(precedingSibling, selector, ancestry);
                });
            }
            if (side === RIGHT) {
                return prop.slice(index, prop.length).some(function (followingSibling) {
                    return match_1.findMatches(followingSibling, selector, ancestry);
                });
            }
        }
        return false;
    });
}
//# sourceMappingURL=sibling.js.map